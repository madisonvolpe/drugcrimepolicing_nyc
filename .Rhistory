Staten Island	2000	85	5	2900	5301
Staten Island	2000	85	5	3300	3180
Staten Island	2000	85	5	3600	2173
Staten Island	2000	85	5	3900	2196
Staten Island	2000	85	5	4000	11105
Staten Island	2000	85	5	4700	3353
Staten Island	2000	85	5	5000	3649
Staten Island	2000	85	5	5900	2633
Staten Island	2000	85	5	6400	3659
Staten Island	2000	85	5	6700	2856
Staten Island	2000	85	5	7000	7298
Staten Island	2000	85	5	7400	3644
Staten Island	2000	85	5	7500	3693
Staten Island	2000	85	5	7700	1566
Staten Island	2000	85	5	8100	4360
Staten Island	2000	85	5	8900	0
Staten Island	2000	85	5	9601	3843
Staten Island	2000	85	5	9602	3340
Staten Island	2000	85	5	9700	3818
Staten Island	2000	85	5	10500	4415
Staten Island	2000	85	5	11201	5590
Staten Island	2000	85	5	11202	5605
Staten Island	2000	85	5	11401	2946
Staten Island	2000	85	5	11402	3254
Staten Island	2000	85	5	12100	3187
Staten Island	2000	85	5	12200	3759
Staten Island	2000	85	5	12500	2803
Staten Island	2000	85	5	12804	3903
Staten Island	2000	85	5	12805	2670
Staten Island	2000	85	5	12806	6262
Staten Island	2000	85	5	13201	1569
Staten Island	2000	85	5	13203	5491
Staten Island	2000	85	5	13204	5138
Staten Island	2000	85	5	13301	1705
Staten Island	2000	85	5	13302	2764
Staten Island	2000	85	5	13400	3721
Staten Island	2000	85	5	13800	6627
Staten Island	2000	85	5	14100	2142
Staten Island	2000	85	5	14604	6600
Staten Island	2000	85	5	14605	3927
Staten Island	2000	85	5	14606	6558
Staten Island	2000	85	5	14607	4655
Staten Island	2000	85	5	14608	3620
Staten Island	2000	85	5	14700	3421
Staten Island	2000	85	5	15100	5030
Staten Island	2000	85	5	15400	7
Staten Island	2000	85	5	15601	6437
Staten Island	2000	85	5	15602	3512
Staten Island	2000	85	5	15603	4392
Staten Island	2000	85	5	16901	2971
Staten Island	2000	85	5	17005	3968
Staten Island	2000	85	5	17007	3006
Staten Island	2000	85	5	17008	8230
Staten Island	2000	85	5	17009	4482
Staten Island	2000	85	5	17010	9278
Staten Island	2000	85	5	17011	4480
Staten Island	2000	85	5	17012	4545
Staten Island	2000	85	5	17300	2540
Staten Island	2000	85	5	17600	4812
Staten Island	2000	85	5	17700	6920
Staten Island	2000	85	5	18100	3084
Staten Island	2000	85	5	18701	1740
Staten Island	2000	85	5	18702	7323
Staten Island	2000	85	5	18901	5290
Staten Island	2000	85	5	18902	4978
Staten Island	2000	85	5	19700	1910
Staten Island	2000	85	5	19800	5059
Staten Island	2000	85	5	20100	3428
Staten Island	2000	85	5	20700	5154
Staten Island	2000	85	5	20801	8261
Staten Island	2000	85	5	20803	5318
Staten Island	2000	85	5	20804	5315
Staten Island	2000	85	5	21300	4759
Staten Island	2000	85	5	22300	2264
Staten Island	2000	85	5	22600	6063
Staten Island	2000	85	5	22800	46
Staten Island	2000	85	5	23100	3281
Staten Island	2000	85	5	23900	2995
Staten Island	2000	85	5	24401	5001
Staten Island	2000	85	5	24402	3400
Staten Island	2000	85	5	24700	2353
Staten Island	2000	85	5	24800	3868
Staten Island	2000	85	5	25100	5776
Staten Island	2000	85	5	27301	3652
Staten Island	2000	85	5	27302	3932
Staten Island	2000	85	5	27702	5883
Staten Island	2000	85	5	27704	3939
Staten Island	2000	85	5	27705	5725
Staten Island	2000	85	5	27706	3118
Staten Island	2000	85	5	27900	2093
Staten Island	2000	85	5	29102	2329
Staten Island	2000	85	5	29103	7570
Staten Island	2000	85	5	29104	6939
Staten Island	2000	85	5	30301	4882
Staten Island	2000	85	5	30302	6125
Staten Island	2000	85	5	31901	3262
Staten Island	2000	85	5	31902	4131
Staten Island	2000	85	5	32300	1017
Staten Island	2000	85	5	990100	0
Staten Island	2010	85	5	300	1927
Staten Island	2010	85	5	600	2408
Staten Island	2010	85	5	700	4915
Staten Island	2010	85	5	800	5583
Staten Island	2010	85	5	900	2112
Staten Island	2010	85	5	1100	3987
Staten Island	2010	85	5	1700	1788
Staten Island	2010	85	5	1800	731
Staten Island	2010	85	5	2001	2504
Staten Island	2010	85	5	2002	3258
Staten Island	2010	85	5	2100	4236
Staten Island	2010	85	5	2700	2217
Staten Island	2010	85	5	2900	5207
Staten Island	2010	85	5	3300	3402
Staten Island	2010	85	5	3600	2510
Staten Island	2010	85	5	3900	2197
Staten Island	2010	85	5	4000	12998
Staten Island	2010	85	5	4700	3863
Staten Island	2010	85	5	5000	3847
Staten Island	2010	85	5	5900	2635
Staten Island	2010	85	5	6400	3550
Staten Island	2010	85	5	6700	2758
Staten Island	2010	85	5	7000	8525
Staten Island	2010	85	5	7400	4693
Staten Island	2010	85	5	7500	3914
Staten Island	2010	85	5	7700	1535
Staten Island	2010	85	5	8100	4301
Staten Island	2010	85	5	8900	0
Staten Island	2010	85	5	9601	4024
Staten Island	2010	85	5	9602	3461
Staten Island	2010	85	5	9700	3925
Staten Island	2010	85	5	10500	5153
Staten Island	2010	85	5	11201	5758
Staten Island	2010	85	5	11202	6428
Staten Island	2010	85	5	11401	3067
Staten Island	2010	85	5	11402	3450
Staten Island	2010	85	5	12100	3065
Staten Island	2010	85	5	12200	3813
Staten Island	2010	85	5	12500	2939
Staten Island	2010	85	5	12804	4259
Staten Island	2010	85	5	12805	3158
Staten Island	2010	85	5	12806	5955
Staten Island	2010	85	5	13201	1558
Staten Island	2010	85	5	13203	5433
Staten Island	2010	85	5	13204	4843
Staten Island	2010	85	5	13301	1633
Staten Island	2010	85	5	13302	3587
Staten Island	2010	85	5	13400	3946
Staten Island	2010	85	5	13800	6535
Staten Island	2010	85	5	14100	2690
Staten Island	2010	85	5	14604	6422
Staten Island	2010	85	5	14605	3836
Staten Island	2010	85	5	14606	6372
Staten Island	2010	85	5	14607	4552
Staten Island	2010	85	5	14608	3510
Staten Island	2010	85	5	14700	3412
Staten Island	2010	85	5	15100	5141
Staten Island	2010	85	5	15400	0
Staten Island	2010	85	5	15601	6330
Staten Island	2010	85	5	15602	3320
Staten Island	2010	85	5	15603	4265
Staten Island	2010	85	5	16901	2970
Staten Island	2010	85	5	17005	4507
Staten Island	2010	85	5	17007	4968
Staten Island	2010	85	5	17008	7388
Staten Island	2010	85	5	17009	4299
Staten Island	2010	85	5	17010	8583
Staten Island	2010	85	5	17011	4549
Staten Island	2010	85	5	17012	4279
Staten Island	2010	85	5	17300	2523
Staten Island	2010	85	5	17600	4815
Staten Island	2010	85	5	17700	7001
Staten Island	2010	85	5	18100	2974
Staten Island	2010	85	5	18701	1807
Staten Island	2010	85	5	18702	7485
Staten Island	2010	85	5	18901	5333
Staten Island	2010	85	5	18902	5064
Staten Island	2010	85	5	19700	1867
Staten Island	2010	85	5	19800	6300
Staten Island	2010	85	5	20100	3572
Staten Island	2010	85	5	20700	6399
Staten Island	2010	85	5	20801	8977
Staten Island	2010	85	5	20803	6463
Staten Island	2010	85	5	20804	5323
Staten Island	2010	85	5	21300	5376
Staten Island	2010	85	5	22300	2880
Staten Island	2010	85	5	22600	8490
Staten Island	2010	85	5	22800	105
Staten Island	2010	85	5	23100	4683
Staten Island	2010	85	5	23900	3250
Staten Island	2010	85	5	24401	5823
Staten Island	2010	85	5	24402	4259
Staten Island	2010	85	5	24700	2702
Staten Island	2010	85	5	24800	4741
Staten Island	2010	85	5	25100	5714
Staten Island	2010	85	5	27301	3820
Staten Island	2010	85	5	27302	3667
Staten Island	2010	85	5	27702	6193
Staten Island	2010	85	5	27704	4108
Staten Island	2010	85	5	27705	5351
Staten Island	2010	85	5	27706	2950
Staten Island	2010	85	5	27900	2137
Staten Island	2010	85	5	29102	2953
Staten Island	2010	85	5	29103	7245
Staten Island	2010	85	5	29104	6735
Staten Island	2010	85	5	30301	4929
Staten Island	2010	85	5	30302	6369
Staten Island	2010	85	5	31901	3265
Staten Island	2010	85	5	31902	4848
Staten Island	2010	85	5	32300	1250
Staten Island	2010	85	5	990100	0
#ids
ids <- read.csv("data/SI_Census_Tract_IDs.csv")
View(ids)
si.democt$GEO_ID
shp.df
ids
rm(ids)
View(si.democt)
#ids
ids <- read.csv("data/SI_Census_Tract_IDs.csv")
View(ids)
ids2 <- shp.df$geoid
ids2 <- data.frame(shp.df$geoid)
View(ids2)
rm(ids)
rm(ids2)
View(si.democt)
View(shp.df)
str_sub(shp.df$geoid, 4,5)
last(str_sub(shp.df$geoid, 4,5))
shp.df[str_sub(shp.df$geoid, 4,5) == "85",]
shp.df
# filter just get staten island census tracts
shp.si <- shp.df[str_sub(shp.df$geoid, 4,5) == "85",]
length(unique(shp.si$geoid))
plot(shp.si)
names(shp.si)
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white")
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_path(color="white")
geom_path(color="white")
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white")
View(shp.df)
View(shp.si)
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Precinct")
shp.si
si.drugs$longitude
si.drugs$latitude
shp.df$long
sf::st_transform(shp.df$long)
shp.df$long
str(shp.df$long)
?st_transform
library(sp)
# read in precinct shapefile
shp <- readOGR(dsn = "shapefiles/CensusTract")
shp@proj4string
?st_transform
# read in precinct shapefile
shp <- readOGR(dsn = "shapefiles/CensusTract")
#convert to epsg:4326
shp <- st_transform(shp, 4326)
st_as_sf(shp)
shp <- st_as_sf(shp)
View(shp)
shp <- readOGR(dsn = "shapefiles/CensusTract")
shp <- st_as_sf(shp)
View(shp)
#convert to epsg:4326
shp <- st_transform(shp, 4326)
View(shp)
sf:::as_Spatial(shp$geom)
x <- sf:::as_Spatial(shp$geom)
View(x)
#convert back to SpatialPolygonsDf
shp <- as(shp, 'Spatial')
#convert back to SpatialPolygonsDf
shp <- as(shp, 'Spatial')
# upload staten island demographics (census tract) dataset
si.democt <-  read.csv("data/CensusTract_Demo.csv")
si.democt <- si.democt[1:11]
si.democt <- filter(si.democt, grepl("Richmond County",GEO_LABEL))
# read in Census Tracy shapefile
shp <- readOGR(dsn = "shapefiles/CensusTract")
#convert to epsg:4326
shp <- st_as_sf(shp)
shp <- st_transform(shp, 4326)
#convert back to SpatialPolygonsDf
shp <- as(shp, 'Spatial')
shp@data$id = shp@data$geoid
shp.points = fortify(shp, region="id")
shp.df = plyr::join(shp.points, shp@data, by="id")
shp.df$geoid <- as.character(shp.df$geoid)
# filter just get staten island census tracts
shp.si <- shp.df[str_sub(shp.df$geoid, 4,5) == "85",]
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Precinct")
st_within()
?st_within
# Count how many drug arrests in each Census Tract
shp_sf<- st_as_sf(shp)
points <- data.frame(long = si.drugs$longitude, lat = si.drugs$latitude)
View(points)
st_within(x = points,y = shp_sf, prepared = T)
points <- st_as_sf(points)
?st_as_sf
points <- st_as_sf(points, coords = c("long", "lat"),
crs = 4326, agr = "constant")
points <- data.frame(long = si.drugs$longitude, lat = si.drugs$latitude)
points <- st_as_sf(points, coords = c("long", "lat"),
crs = 4326, agr = "constant")
st_within(x = points,y = shp_sf, prepared = T)
test <- st_within(x = points,y = shp_sf, prepared = T)
View(test)
?st_within
View(shp_sf)
pointswithib <- st_within(x = points,y = shp_sf, prepared = T)
pointswithin <- st_within(x = points,y = shp_sf, prepared = T)
rm(test)
rm(pointswithib)
rm(x)
View(pointswithin)
View(points)
View(pointswithin)
pointswithin[[1]]
si.drugs[[1]]
si.drugs$latitude
c(si.drugs$longitude[1],si.drugs$latitude[1])
View(shp_sf)
table(pointswithin)
pointswithin[[1]]
pointswithin[1]
as.data.frame(pointswithin)
pw <- as.data.frame(pointswithin)
range(pw$col.id)
View(shp_sf)
# Map showing arrests by race wi
table(pw)
# Map showing arrests by race wi
table(pw$col.id)
# Map showing arrests by race wi
shp_sf[pw$col.id]
# Map showing arrests by race wi
shp_sf[pw$col.id,]
View(shp_sf)
range(pw$col.id)
row_number(shp_sf)
View(pw)
rownames(shp_sf)
range(rownames(shp_sf))
v <- rownames(shp_sf)
range(v)
rm(v)
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Precinct")
ggplot(shp.si) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
View(shp.si)
View(si.democt)
View(shp.si)
names(si.democt)[2]
names(si.democt)[2] <- "geoid"
join(shp.si, si.democt, by = "geoid")
#join demo to shp dataframe
shp.si.demo<-join(shp.si, si.democt, by = "geoid")
View(shp.si.demo)
ggplot(shp.si) +
aes(long,lat,group=group, fill = Black) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
names(shp.si.demo)
ggplot(shp.si) +
aes(long,lat,group=group,fill = factor(Black)) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
ggplot(shp.si.demo) +
aes(long,lat,group=group,fill = factor(Black)) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
ggplot(shp.si.demo) +
aes(long,lat,group=group,fill = Black) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
range(shp.si.demo$Black)
shp.si.demo$Black
?scale_color_continuous
str(shp.si.demo)
shp.si.demo$Black <- as.numeric(as.character(shp.si.demo$Black))
View(si.democt)
str(shp.si.demo)
?scale_color_continuous
ggplot(shp.si.demo) +
aes(long,lat,group=group,col = Black) +
scale_color_gradient(low = "#132B43", high = "#56B1F7") +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
str(shp.si.demo$Black)
ggplot(shp.si.demo) +
aes(long,lat,group=group,col=Black) +
scale_fill_gradient(low = "#132B43", high = "#56B1F7") +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
ggplot(shp.si.demo) +
aes(long,lat,group=group,col=Black) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
str(shp.si.demo$Black)
shp.si.demo$Black <- as.numeric(as.character(shp.si.demo$Black))
ggplot(shp.si.demo) +
aes(long,lat,group=group,col=Black) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
ggplot(shp.si.demo) +
aes(long,lat,group=group) +
geom_polygon() +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
ggplot(shp.si.demo) +
aes(long,lat,group=group) +
geom_polygon(aes(fill=Black)) +
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
?scale_fill_continuous
ggplot(shp.si.demo) +
aes(long,lat,group=group) +
geom_polygon(aes(fill=Black)) +
scale_fill_continuous(type = "viridis")+
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract")
shp.si.demo$White <- as.numeric(as.character(shp.si.demo$White))
ggplot(shp.si.demo) +
aes(long,lat,group=group) +
geom_polygon(aes(fill=White)) +
scale_fill_continuous(type = "viridis")+
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract (Black Population)")
ggplot(shp.si.demo) +
aes(long,lat,group=group) +
geom_polygon(aes(fill=Black)) +
scale_fill_continuous(type = "viridis")+
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract (Black Population)")
ggplot(shp.si.demo) +
aes(long,lat,group=group) +
geom_polygon(aes(fill=White)) +
scale_fill_continuous(type = "viridis")+
geom_path(color="white") +
geom_point(data = si.drugs,aes(x=longitude, y=latitude, col= factor(perp_race)), alpha=0.2, inherit.aes=FALSE) +
theme_bw() +
ggtitle("Arrests by Race in each Census Tract (White Population)")
