Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units) %>%
mutate(year=2017)
ACS.16.c <- select(ACS.16, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units)%>%
mutate(year=2016)
ACS.15.c <- select(ACS.15, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units) %>%
mutate(year=2015)
ACS.14.c <- select(ACS.14, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units) %>%
mutate(year=2014)
ACS <- rbind(ACS.14.c, ACS.15.c, ACS.16.c, ACS.17.c)
names(ACS)
# change names of df
names(ACS) <- c('zip', 'Total.Population', 'Total.Population.Over18',
'White', 'Black', 'Two.Races', 'Hispanic.Latino',
'White.Alone', 'Black.Alone', 'Native.Alone',
'Asian.Alone', 'PacificIslander.Alone',
'Some.Other.Race.Alone', 'Two.More.Races.Alone',
'Total.Houshing.Units', 'year')
View(ACS)
# filter for SI zipcodes
ACS  <- filter(ACS, zip %in% c(10304, 10305, 10306, 10307, 10301, 10302, 10303, 10308,
10309, 10310, 10311, 10312, 10313, 10314))
# change names of df
names(ACS) <- c('zip', 'Total.Population', 'Total.Population.Over18',
'White', 'Black', 'Two.Races', 'Hispanic.Latino',
'White.Alone', 'Black.Alone', 'Native.Alone',
'Asian.Alone', 'PacificIslander.Alone',
'Some.Other.Race.Alone', 'Two.More.Races.Alone',
'Total.Houshing.Units', 'year')
names(ACS)
View(ACS)
# join in relevant dataset
ACS <- rbind(ACS.14.c, ACS.15.c, ACS.16.c, ACS.17.c)
names(ACS)
# join in relevant dataset
ACS <- rbind(ACS.14.c, ACS.15.c, ACS.16.c, ACS.17.c)
# change names of df
names(ACS) <- c('zip', 'Total.Population', 'Total.Population.Over18',
'White', 'Black', 'Two.Races', 'Hispanic.Latino', 'Not.Hispanic.Latino'
'White.Alone', 'Black.Alone', 'Native.Alone',
'Asian.Alone', 'PacificIslander.Alone',
'Some.Other.Race.Alone', 'Two.More.Races.Alone',
'Total.Houshing.Units', 'year')
# join in relevant dataset
ACS <- rbind(ACS.14.c, ACS.15.c, ACS.16.c, ACS.17.c)
# change names of df
names(ACS) <- c('zip', 'Total.Population', 'Total.Population.Over18',
'White', 'Black', 'Two.Races', 'Hispanic.Latino', 'Not.Hispanic.Latino',
'White.Alone', 'Black.Alone', 'Native.Alone',
'Asian.Alone', 'PacificIslander.Alone',
'Some.Other.Race.Alone', 'Two.More.Races.Alone',
'Total.Houshing.Units', 'year')
# filter for SI zipcodes
ACS  <- filter(ACS, zip %in% c(10304, 10305, 10306, 10307, 10301, 10302, 10303, 10308,
10309, 10310, 10311, 10312, 10313, 10314))
View(ACS)
# join in relevant dataset
ACS <- rbind(ACS.14.c, ACS.15.c, ACS.16.c, ACS.17.c)
# change names of df
names(ACS) <- c('zip', 'Total.Population', 'Total.Population.Over18',
'White', 'Black', 'Two.Races', 'Hispanic.Latino', 'Not.Hispanic.Latino',
'White.Alone', 'Black.Alone', 'Native.Alone',
'Asian.Alone', 'PacificIslander.Alone',
'Some.Other.Race.Alone', 'Two.More.Races.Alone',
'Total.Housing.Units', 'year')
library(tidyverse)
ACS.17 <- read.csv("data/ACS_Demo/ACS_2017.csv")
ACS.16 <- read.csv("data/ACS_Demo/ACS_2016.csv")
ACS.15 <- read.csv("data/ACS_Demo/ACS_2015.csv")
ACS.14 <- read.csv("data/ACS_Demo/ACS_2014.csv")
# select relevant variables
ACS.17.c <- select(ACS.17, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units) %>%
mutate(year=2017)
ACS.16.c <- select(ACS.16, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units)%>%
mutate(year=2016)
ACS.15.c <- select(ACS.15, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units) %>%
mutate(year=2015)
ACS.14.c <- select(ACS.14, Id2, Estimate..SEX.AND.AGE...Total.population, Estimate..SEX.AND.AGE...18.years.and.over,
Estimate..RACE...One.race...White, Estimate..RACE...One.race...Black.or.African.American,
Estimate..RACE...Two.or.more.races,Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Hispanic.or.Latino..of.any.race.,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...White.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Black.or.African.American.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...American.Indian.and.Alaska.Native.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Asian.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Native.Hawaiian.and.Other.Pacific.Islander.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Some.other.race.alone,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.population...Not.Hispanic.or.Latino...Two.or.more.races,
Estimate..HISPANIC.OR.LATINO.AND.RACE...Total.housing.units) %>%
mutate(year=2014)
# join in relevant dataset
ACS <- rbind(ACS.14.c, ACS.15.c, ACS.16.c, ACS.17.c)
# change names of df
names(ACS) <- c('zip', 'Total.Population', 'Total.Population.Over18',
'White', 'Black', 'Two.Races', 'Hispanic.Latino', 'Not.Hispanic.Latino',
'White.Alone', 'Black.Alone', 'Native.Alone',
'Asian.Alone', 'PacificIslander.Alone',
'Some.Other.Race.Alone', 'Two.More.Races.Alone',
'Total.Housing.Units', 'year')
# filter for SI zipcodes
ACS  <- filter(ACS, zip %in% c(10304, 10305, 10306, 10307, 10301, 10302, 10303, 10308,
10309, 10310, 10311, 10312, 10313, 10314))
write_csv(ACS, "data/ACS_Demo/ACS.14_17.csv")
rm(list=ls())
## We need the following datasets:
## drug arrest
## zip shapefile
## ems calls
## demo by zip
library(plyr)
library(tidyverse)
library(ggplot2)
library(sf)
library(maptools)
library(rgdal)
library(rgeos)
library(reshape2)
### DATASET ONE ###
# First we will get the count of the number of drug arrests that occured in each zipcode
# read in drug arrests
drugs <- read.csv("data/si_drugs_mod_arrests.csv")
names(drugs)
unique(drugs$age_group)
table(drugs$age_group)
## We need the following datasets:
## drug arrest
## zip shapefile
## ems calls
## demo by zip
library(plyr)
library(tidyverse)
library(ggplot2)
library(sf)
library(maptools)
library(rgdal)
library(rgeos)
library(reshape2)
### DATASET ONE ###
# First we will get the count of the number of drug arrests that occured in each zipcode
# read in drug arrests
drugs <- read.csv("data/si_drugs_mod_arrests.csv")
# read in zip shapefile
zip   <-readOGR(dsn = "shapefiles/ZipCode")
# convert zip to sf
zip <- st_as_sf(zip)
zip <- zip[,c(1,4)]
# filter for SI zip codes only
zip <- filter(zip, zcta %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10311, 10313))
colnames(zip) <- c("zip", "geometry")
# transfom zip to 4326
zip <- st_transform(zip, 4326)
# get points from drugs dataset
points <- data.frame(x = drugs$longitude,  y = drugs$latitude, id = 1:nrow(drugs))
points <- st_as_sf(points, coords = c("x", "y"), crs = 4326)
# Intersection between polygon and points -
intersection <- st_intersection(x = zip, y = points)
# Counts
intresult <- intersection %>%
group_by(zip) %>%
count() %>%
select(zip,n)
final_arrest_counts_by_zip <- as.data.frame(intresult)[,-3] # lost some observations (4) but that is okay
final_arrest_counts_by_zip$zip <- as.numeric(as.character(final_arrest_counts_by_zip$zip))
names(final_arrest_counts_by_zip)[2] <- 'no.drug.arrests.13.18'
#also note no arrests were made in 10311, 10313 - this is bc these areas are not very populated
## get ems counts
# emsorig   <- read.csv("data/ems_original.csv")
#
# emisorig <- filter(emsorig, zipcode %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
#                   10312, 10301, 10304, 10305, 10314, 10311, 10313))
#
# !c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
#    10312, 10301, 10304, 10305, 10314, 10311, 10313) %in% unique(emisorig$zipcode)
ems <- read.csv("data/emsdrugs.csv")
final_ems_counts_by_zip <- ems %>%
group_by(zipcode) %>%
count() %>%
select(zipcode,n)
names(final_ems_counts_by_zip)[1] <- 'zip'
names(final_ems_counts_by_zip)[2] <- 'no.ems.calls.13.18'
# join arrests and ems counts
zip_model_dataset <- left_join(final_arrest_counts_by_zip, final_ems_counts_by_zip, by = 'zip')
rm(list=ls())
## We need the following datasets:
## drug arrest
## zip shapefile
## ems calls
## demo by zip
library(plyr)
library(tidyverse)
library(ggplot2)
library(sf)
library(maptools)
library(rgdal)
library(rgeos)
library(reshape2)
### DATASET ONE ###
# First we will get the count of the number of drug arrests that occured in each zipcode
# read in drug arrests
drugs <- read.csv("data/si_drugs_mod_arrests.csv")
# read in zip shapefile
zip   <-readOGR(dsn = "shapefiles/ZipCode")
# convert zip to sf
zip <- st_as_sf(zip)
zip <- zip[,c(1,4)]
# filter for SI zip codes only
zip <- filter(zip, zcta %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10311, 10313))
colnames(zip) <- c("zip", "geometry")
# transfom zip to 4326
zip <- st_transform(zip, 4326)
# get points from drugs dataset
points <- data.frame(x = drugs$longitude,  y = drugs$latitude, id = 1:nrow(drugs))
points <- st_as_sf(points, coords = c("x", "y"), crs = 4326)
# Intersection between polygon and points -
intersection <- st_intersection(x = zip, y = points)
# Counts
intresult <- intersection %>%
group_by(zip) %>%
count() %>%
select(zip,n)
final_arrest_counts_by_zip <- as.data.frame(intresult)[,-3] # lost some observations (4) but that is okay
final_arrest_counts_by_zip$zip <- as.numeric(as.character(final_arrest_counts_by_zip$zip))
names(final_arrest_counts_by_zip)[2] <- 'no.drug.arrests.13.18'
#also note no arrests were made in 10311, 10313 - this is bc these areas are not very populated
## get ems counts
# emsorig   <- read.csv("data/ems_original.csv")
#
# emisorig <- filter(emsorig, zipcode %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
#                   10312, 10301, 10304, 10305, 10314, 10311, 10313))
#
# !c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
#    10312, 10301, 10304, 10305, 10314, 10311, 10313) %in% unique(emisorig$zipcode)
ems <- read.csv("data/emsdrugs.csv")
final_ems_counts_by_zip <- ems %>%
group_by(zipcode) %>%
count() %>%
select(zipcode,n)
names(final_ems_counts_by_zip)[1] <- 'zip'
names(final_ems_counts_by_zip)[2] <- 'no.ems.calls.13.18'
# join arrests and ems counts
zip_model_dataset <- left_join(final_arrest_counts_by_zip, final_ems_counts_by_zip, by = 'zip')
demo <- read.csv("data/ACS_Demo/ACS.14_17.csv")
names(demo)
demo <- filter(demo, zip %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10311, 10313))
demo <- filter(demo, year == 2017 ) # for lunp sum estimates use 2017
View(demo)
demo <- read.csv("data/ACS_Demo/ACS.14_17.csv")
demo <- filter(demo, zip %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10313))
demo <- filter(demo, year == 2017 ) # for lunp sum estimates use 2017
View(demo)
29862 + 16424 + 9119 + 20 + 2312 + 0 +126 + 1861
16424 + 9119 + 20 + 2312 + 0 +126 + 1861
29862 + 9589
demo <- read.csv("data/ACS_Demo/ACS.14_17.csv")
demo <- filter(demo, zip %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10313))
demo <- filter(demo, year == 2017 ) # for lunp sum estimates use 2017
demofinal <- demo %>%
select(zip, Total.Population, Total.Population.Over18, White.Alone) %>%
mutate(proportionWhite = (White.Alone/Total.Population),
proportionNonWhite = ((Total.Population-White.Alone)/
Total.Population))%>%
select(zip, Total.Population, Total.Population.Over18, proportionWhite, proportionNonWhite)
View(demofinal)
View(demofinal)
# join demographics with data
zip_model_dataset <- left_join(zip_model_dataset, demofinal, by = 'zip')
View(zip_model_dataset)
# add in extra drug activity dataset
zip.extra.drug <- read.csv("data/ZipCodeDrugStats.csv")
getwd()
# add in extra drug activity dataset
zip.extra.drug <- read.csv("data/ZipCodeDrugStats .csv")
# add in extra drug activity dataset
zip.extra.drug <- read.csv("data/ZipCodeDrugStats.csv")
View(zip.extra.drug)
names(zip.extra.drug)[1] <- 'zip'
names(zip)
names(zip.extra.drug)
zip.extra.drug <- select(zip.extra.drug, zip, Total.Naxolone.Saves, Overdose.Death.Total)
View(zip.extra.drug)
## We need the following datasets:
## drug arrest
## zip shapefile
## ems calls
## demo by zip
library(plyr)
library(tidyverse)
library(ggplot2)
library(sf)
library(maptools)
library(rgdal)
library(rgeos)
library(reshape2)
### DATASET ONE ###
# First we will get the count of the number of drug arrests that occured in each zipcode
# read in drug arrests
drugs <- read.csv("data/si_drugs_mod_arrests.csv")
# read in zip shapefile
zip   <-readOGR(dsn = "shapefiles/ZipCode")
# convert zip to sf
zip <- st_as_sf(zip)
zip <- zip[,c(1,4)]
# filter for SI zip codes only
zip <- filter(zip, zcta %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10311, 10313))
colnames(zip) <- c("zip", "geometry")
# transfom zip to 4326
zip <- st_transform(zip, 4326)
# get points from drugs dataset
points <- data.frame(x = drugs$longitude,  y = drugs$latitude, id = 1:nrow(drugs))
points <- st_as_sf(points, coords = c("x", "y"), crs = 4326)
# Intersection between polygon and points -
intersection <- st_intersection(x = zip, y = points)
# Counts
intresult <- intersection %>%
group_by(zip) %>%
count() %>%
select(zip,n)
final_arrest_counts_by_zip <- as.data.frame(intresult)[,-3] # lost some observations (4) but that is okay
final_arrest_counts_by_zip$zip <- as.numeric(as.character(final_arrest_counts_by_zip$zip))
names(final_arrest_counts_by_zip)[2] <- 'no.drug.arrests.13.18'
#also note no arrests were made in 10311, 10313 - this is bc these areas are not very populated
## get ems counts
# emsorig   <- read.csv("data/ems_original.csv")
#
# emisorig <- filter(emsorig, zipcode %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
#                   10312, 10301, 10304, 10305, 10314, 10311, 10313))
#
# !c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
#    10312, 10301, 10304, 10305, 10314, 10311, 10313) %in% unique(emisorig$zipcode)
ems <- read.csv("data/emsdrugs.csv")
final_ems_counts_by_zip <- ems %>%
group_by(zipcode) %>%
count() %>%
select(zipcode,n)
names(final_ems_counts_by_zip)[1] <- 'zip'
names(final_ems_counts_by_zip)[2] <- 'no.ems.calls.13.18'
# join arrests and ems counts
zip_model_dataset <- left_join(final_arrest_counts_by_zip, final_ems_counts_by_zip, by = 'zip')
# add demographics
demo <- read.csv("data/ACS_Demo/ACS.14_17.csv")
demo <- filter(demo, zip %in% c(10302, 10303, 10310, 10306, 10307, 10308, 10309,
10312, 10301, 10304, 10305, 10314, 10313))
demo <- filter(demo, year == 2017 ) # for lump sum estimates use (ACS 2017 5 year estimates)
demofinal <- demo %>%
select(zip, Total.Population, Total.Population.Over18, White.Alone) %>%
mutate(proportionWhite = (White.Alone/Total.Population),
proportionNonWhite = ((Total.Population-White.Alone)/
Total.Population))%>%
select(zip, Total.Population, Total.Population.Over18, proportionWhite, proportionNonWhite)
# join demographics with data
zip_model_dataset <- left_join(zip_model_dataset, demofinal, by = 'zip')
write_csv(zip_model_dataset, "data/ModelDatasets/zipcodeModel1.csv")
# add in extra drug activity dataset
zip.extra.drug <- read.csv("data/ZipCodeDrugStats.csv")
names(zip.extra.drug)[1] <- 'zip'
zip.extra.drug <- select(zip.extra.drug, zip, Total.Naxolone.Saves, Overdose.Death.Total)
zip_model_dataset2 <- left_join(zip_model_dataset, zip.extra.drug, by = 'zip')
View(zip_model_dataset2)
write_csv(zip_model_dataset2, "data/ModelDatasets/zipcodeModel3.csv")
rm(list=ls())
mod1dat <- read.csv("data/ModelDatasets/zipcodeModel1.csv")
mod1dat$zip <- factor(mod1dat$zip)
View(mod1dat)
mod1dat$zip <- factor(mod1dat$zip)
View(mod1dat)
mod1 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite,
offset = log(Total.Population),family = poisson ,data = mod1dat)
arm::display(mod1)
summary(mod1)
names(mod1)
names(mod1dat)
mod1 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite,
offset = log(Total.Population.Over18),family = poisson ,data = mod1dat)
arm::display(mod1)
mod1 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite,
offset = log(Total.Population.Over18),family = poisson ,data = mod1dat)
arm::display(mod1)
summary(mod1)
exp(2.07)
yhat <- predict(mod1, type = 'response')
z <- (mod1dat$no.drug.arrests.13.18 - yhat) / sqrt(yhat)
cat('overdispersion ratio is', sum(z^2)/(12-3), "\n")
cat('p-value of overdispersion test is', pchisq(sum(z^2), 12-3), "\n")
y.hat <- predict(mod1, type = 'response')
u <- resid(mod1)
sigma <- arm::sigma.hat(mod1)
arm::residual.plot(y.hat,u, sigma)
knitr::opts_chunk$set(echo = TRUE)
mod1dat <- read.csv("data/ModelDatasets/zipcodeModel1.csv")
mod1dat$zip <- factor(mod1dat$zip)
mod1 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite,
offset = log(Total.Population.Over18),family = poisson ,data = mod1dat)
arm::display(mod1)
summary(mod1)
yhat <- predict(mod1, type = 'response')
z <- (mod1dat$no.drug.arrests.13.18 - yhat) / sqrt(yhat)
cat('overdispersion ratio is', sum(z^2)/(12-3), "\n")
cat('p-value of overdispersion test is', pchisq(sum(z^2), 12-3), "\n")
y.hat <- predict(mod1, type = 'response')
u <- resid(mod1)
sigma <- arm::sigma.hat(mod1)
arm::residual.plot(y.hat,u, sigma)
names(mod1)
names(mod1dat)
mod1quasi <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite,
offset  = log(Total.Population.Over1),family = quasipoisson ,data = mod1dat)
mod1quasi <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite,
offset  = log(Total.Population.Over18),family = quasipoisson ,data = mod1dat)
summary(mod1quasi)
mod3dat <- read.csv("data/ModelDatasets/zipcodeModel3.csv")
View(mod3dat)
names(mod3dat)
mod3 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite + Total.Naxolone.Saves +
Overdose.Death.Total, offset = log(Total.Population.Over18),family = poisson, data = mod3dat)
arm::display(mod3)
mod3 <- glm(formula = no.drug.arrests.13.18 ~ proportionNonWhite + Total.Naxolone.Saves +
Overdose.Death.Total, offset = log(Total.Population.Over18),family = poisson, data = mod3dat)
arm::display(mod3)
mod3 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite + Total.Naxolone.Saves +
Overdose.Death.Total, offset = log(Total.Population.Over18),family = poisson, data = mod3dat)
arm::display(mod3)
summary(mod3)
arm::display(mod3)
yhat <- predict(mod3, type = 'response')
z <- (mod3dat$no.drug.arrests.13.18 - yhat) / sqrt(yhat)
cat('overdispersion ratio is', sum(z^2)/(12-5), "\n") #n -k
cat('p-value of overdispersion test is', pchisq(sum(z^2), 12-5), "\n")
mod3dat <- read.csv("data/ModelDatasets/zipcodeModel3.csv")
mod3 <- glm(formula = no.drug.arrests.13.18 ~ no.ems.calls.13.18 + proportionNonWhite + Total.Naxolone.Saves +
Overdose.Death.Total, offset = log(Total.Population.Over18),family = poisson, data = mod3dat)
arm::display(mod3)
summary(mod3)
yhat <- predict(mod3, type = 'response')
z <- (mod3dat$no.drug.arrests.13.18 - yhat) / sqrt(yhat)
cat('overdispersion ratio is', sum(z^2)/(12-5), "\n") #n -k
cat('p-value of overdispersion test is', pchisq(sum(z^2), 12-5), "\n")
